# 段階的移行とリグレッション検証ガイド

## パイロット移行 (7.1)
- 対象: メンバー一覧（現行でServer Action経由に移行済み）。
- 手順: 影響範囲を最小化し、旧構成との差分を記録。問題時はパイロットブランチへロールバック。

## 全機能移行 (7.2)
- 優先順: イベント → タイムテーブル → 管理/プロフィール。
- インポート更新: lib/types由来の参照は `@/application`, `@/domain`, `@/infrastructure` へ段階的に書き換え。
- 再利用: layer-mapping.jsonを元に自動置換スクリプト（後述）で計画的に実行。

## リグレッション検証とロールバック (7.3)
- 回帰確認: `npm test` + `npm run test:arch` を段階ごとに実行。主要フロー（プロフィール表示/イベント登録/管理操作/タイムテーブル表示）は手動確認またはE2Eで担保。
- ロールバック: 各段階でタグを打ち、問題発生時は直前タグへ戻す。DB変更なしのためコードロールバックのみで復旧可能。

## 自動置換スクリプト概要
- `tools/migration/layer-mapping.json` を参照し、旧パス→新レイヤーエイリアスに置換するユーティリティを追加（テストで変換結果を検証）。
- 実行例（想定）: `node tools/migration/apply-layer-mapping.js --dry-run`
